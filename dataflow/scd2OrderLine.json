{
	"name": "scd2OrderLine",
	"properties": {
		"type": "MappingDataFlow",
		"typeProperties": {
			"sources": [
				{
					"dataset": {
						"referenceName": "SalesOrderLinesODS",
						"type": "DatasetReference"
					},
					"name": "SalesOrderLines"
				},
				{
					"dataset": {
						"referenceName": "SalesOrderLinesINTEGRATION",
						"type": "DatasetReference"
					},
					"name": "SalesOrderLineTable"
				}
			],
			"sinks": [
				{
					"dataset": {
						"referenceName": "SalesOrderLinesINTEGRATION",
						"type": "DatasetReference"
					},
					"name": "sink1"
				},
				{
					"dataset": {
						"referenceName": "SalesOrderINTEGRATION",
						"type": "DatasetReference"
					},
					"name": "sink2"
				}
			],
			"transformations": [
				{
					"name": "AddingIsActive"
				},
				{
					"name": "SurrogateKey1"
				},
				{
					"name": "Select1"
				},
				{
					"name": "Lookup1"
				},
				{
					"name": "ExistingRows"
				},
				{
					"name": "Select2"
				},
				{
					"name": "DerivedColumn1"
				},
				{
					"name": "AlterRow1"
				}
			],
			"script": "source(output(\n\t\tOrderLineID as integer,\n\t\tOrderID as integer,\n\t\tStockItemID as integer,\n\t\tDescription as string,\n\t\tPackageTypeID as integer,\n\t\tQuantity as integer,\n\t\tUnitPrice as decimal(18,2),\n\t\tTaxRate as decimal(18,3),\n\t\tPickedQuantity as integer,\n\t\tPickingCompletedWhen as timestamp,\n\t\tLastEditedBy as integer,\n\t\tLastEditedWhen as timestamp\n\t),\n\tallowSchemaDrift: false,\n\tvalidateSchema: true,\n\tisolationLevel: 'READ_UNCOMMITTED',\n\tformat: 'table') ~> SalesOrderLines\nsource(output(\n\t\tOrderLineID as integer,\n\t\tOrderID as integer,\n\t\tStockItemID as integer,\n\t\tDescription as string,\n\t\tPackageTypeID as integer,\n\t\tQuantity as integer,\n\t\tUnitPrice as decimal(18,0),\n\t\tTaxRate as decimal(18,0),\n\t\tPickedQuantity as integer,\n\t\tPickingCompletedWhen as timestamp,\n\t\tLastEditedBy as integer,\n\t\tLastEditedWhen as timestamp\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tisolationLevel: 'READ_UNCOMMITTED',\n\tformat: 'table') ~> SalesOrderLineTable\nSalesOrderLines derive(IsActive = 1) ~> AddingIsActive\nAddingIsActive keyGenerate(output(SurrogateKey as long),\n\tstartAt: 1L) ~> SurrogateKey1\nSalesOrderLineTable select(mapColumn(\n\t\tSQL_OrderLineID = OrderLineID,\n\t\tSQL_OrderID = OrderID,\n\t\tSQL_StockItemID = StockItemID,\n\t\tSQL_Description = Description,\n\t\tSQL_PackageTypeID = PackageTypeID,\n\t\tSQL_Quantity = Quantity,\n\t\tSQL_UnitPrice = UnitPrice,\n\t\tSQL_TaxRate = TaxRate,\n\t\tSQL_PickedQuantity = PickedQuantity,\n\t\tSQL_PickingCompletedWhen = PickingCompletedWhen,\n\t\tSQL_LastEditedBy = LastEditedBy,\n\t\tSQL_LastEditedWhen = LastEditedWhen\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> Select1\nSalesOrderLines, Select1 lookup(SalesOrderLines@OrderID == SQL_OrderID,\n\tmultiple: true,\n\tbroadcast: 'auto')~> Lookup1\nLookup1 filter(!isNull(SQL_OrderID)) ~> ExistingRows\nExistingRows select(mapColumn(\n\t\tSQL_OrderID,\n\t\tSQL_CustomerID,\n\t\tSQL_SalespersonPersonID,\n\t\tSQL_PickedByPersonID,\n\t\tSQL_ContactPersonID,\n\t\tSQL_BackorderOrderID,\n\t\tSQL_OrderDate,\n\t\tSQL_ExpectedDeliveryDate,\n\t\tSQL_CustomerPurchaseOrderNumber,\n\t\tSQL_IsUndersupplyBackordered,\n\t\tSQL_Comments,\n\t\tSQL_DeliveryInstructions,\n\t\tSQL_InternalComments,\n\t\tSQL_PickingCompletedWhen,\n\t\tSQL_LastEditedBy,\n\t\tSQL_LastEditedWhen,\n\t\tSQL_IsActive,\n\t\tSQL_SurrogateKey\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> Select2\nSelect2 derive(SQL_IsActive = 0) ~> DerivedColumn1\nDerivedColumn1 alterRow(updateIf(1==1)) ~> AlterRow1\nSurrogateKey1 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tinput(\n\t\tOrderLineID as integer,\n\t\tOrderID as integer,\n\t\tStockItemID as integer,\n\t\tDescription as string,\n\t\tPackageTypeID as integer,\n\t\tQuantity as integer,\n\t\tUnitPrice as decimal(18,0),\n\t\tTaxRate as decimal(18,0),\n\t\tPickedQuantity as integer,\n\t\tPickingCompletedWhen as timestamp,\n\t\tLastEditedBy as integer,\n\t\tLastEditedWhen as timestamp\n\t),\n\tdeletable:false,\n\tinsertable:true,\n\tupdateable:false,\n\tupsertable:false,\n\tformat: 'table',\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\tsaveOrder: 2,\n\terrorHandlingOption: 'stopOnFirstError',\n\tmapColumn(\n\t\tOrderLineID,\n\t\tOrderID,\n\t\tStockItemID,\n\t\tDescription,\n\t\tPackageTypeID,\n\t\tQuantity,\n\t\tUnitPrice,\n\t\tTaxRate,\n\t\tPickedQuantity,\n\t\tPickingCompletedWhen,\n\t\tLastEditedBy,\n\t\tLastEditedWhen,\n\t\tIsActive\n\t)) ~> sink1\nAlterRow1 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tinput(\n\t\tOrderID as integer,\n\t\tCustomerID as integer,\n\t\tSalespersonPersonID as integer,\n\t\tPickedByPersonID as integer,\n\t\tContactPersonID as integer,\n\t\tBackorderOrderID as integer,\n\t\tOrderDate as date,\n\t\tExpectedDeliveryDate as date,\n\t\tCustomerPurchaseOrderNumber as string,\n\t\tIsUndersupplyBackordered as boolean,\n\t\tComments as string,\n\t\tDeliveryInstructions as string,\n\t\tInternalComments as string,\n\t\tPickingCompletedWhen as timestamp,\n\t\tLastEditedBy as integer,\n\t\tLastEditedWhen as timestamp,\n\t\tIsActive as integer,\n\t\tSurrogateKey as integer\n\t),\n\tdeletable:false,\n\tinsertable:false,\n\tupdateable:true,\n\tupsertable:false,\n\tkeys:['SurrogateKey'],\n\tformat: 'table',\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\tsaveOrder: 1,\n\terrorHandlingOption: 'stopOnFirstError',\n\tmapColumn(\n\t\tOrderID = SQL_OrderID,\n\t\tCustomerID = SQL_CustomerID,\n\t\tSalespersonPersonID = SQL_SalespersonPersonID,\n\t\tPickedByPersonID = SQL_PickedByPersonID,\n\t\tContactPersonID = SQL_ContactPersonID,\n\t\tBackorderOrderID = SQL_BackorderOrderID,\n\t\tOrderDate = SQL_OrderDate,\n\t\tExpectedDeliveryDate = SQL_ExpectedDeliveryDate,\n\t\tCustomerPurchaseOrderNumber = SQL_CustomerPurchaseOrderNumber,\n\t\tIsUndersupplyBackordered = SQL_IsUndersupplyBackordered,\n\t\tComments = SQL_Comments,\n\t\tDeliveryInstructions = SQL_DeliveryInstructions,\n\t\tInternalComments = SQL_InternalComments,\n\t\tPickingCompletedWhen = SQL_PickingCompletedWhen,\n\t\tLastEditedBy = SQL_LastEditedBy,\n\t\tLastEditedWhen = SQL_LastEditedWhen,\n\t\tIsActive = SQL_IsActive,\n\t\tSurrogateKey = SQL_SurrogateKey\n\t)) ~> sink2"
		}
	}
}