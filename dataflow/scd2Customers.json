{
	"name": "scd2Customers",
	"properties": {
		"type": "MappingDataFlow",
		"typeProperties": {
			"sources": [
				{
					"dataset": {
						"referenceName": "SalesCustomersODS",
						"type": "DatasetReference"
					},
					"name": "Customers"
				},
				{
					"dataset": {
						"referenceName": "SalesCustomersINTEGRATION",
						"type": "DatasetReference"
					},
					"name": "SalesCustomersTable"
				}
			],
			"sinks": [
				{
					"dataset": {
						"referenceName": "SalesCustomersINTEGRATION",
						"type": "DatasetReference"
					},
					"name": "sink1"
				},
				{
					"dataset": {
						"referenceName": "SalesCustomersINTEGRATION",
						"type": "DatasetReference"
					},
					"name": "sink2"
				}
			],
			"transformations": [
				{
					"name": "AddingIsActive"
				},
				{
					"name": "SurrogateKey1"
				},
				{
					"name": "Select1"
				},
				{
					"name": "Lookup1"
				},
				{
					"name": "ExistingRows"
				},
				{
					"name": "DerivedColumn1"
				},
				{
					"name": "AlterRow1"
				},
				{
					"name": "Select2"
				}
			],
			"script": "source(output(\n\t\tCustomerID as integer,\n\t\tCustomerName as string,\n\t\tBillToCustomerID as integer,\n\t\tCustomerCategoryID as integer,\n\t\tBuyingGroupID as integer,\n\t\tPrimaryContactPersonID as integer,\n\t\tAlternateContactPersonID as integer,\n\t\tDeliveryMethodID as integer,\n\t\tDeliveryCityID as integer,\n\t\tPostalCityID as integer,\n\t\tCreditLimit as decimal(18,2),\n\t\tAccountOpenedDate as date,\n\t\tStandardDiscountPercentage as decimal(18,3),\n\t\tIsStatementSent as boolean,\n\t\tIsOnCreditHold as boolean,\n\t\tPaymentDays as integer,\n\t\tPhoneNumber as string,\n\t\tFaxNumber as string,\n\t\tDeliveryRun as string,\n\t\tRunPosition as string,\n\t\tWebsiteURL as string,\n\t\tDeliveryAddressLine1 as string,\n\t\tDeliveryAddressLine2 as string,\n\t\tDeliveryPostalCode as string,\n\t\tDeliveryLocation as binary,\n\t\tPostalAddressLine1 as string,\n\t\tPostalAddressLine2 as string,\n\t\tPostalPostalCode as string,\n\t\tLastEditedBy as integer,\n\t\tValidFrom as timestamp,\n\t\tValidTo as timestamp\n\t),\n\tallowSchemaDrift: false,\n\tvalidateSchema: true,\n\tisolationLevel: 'READ_UNCOMMITTED',\n\tformat: 'table') ~> Customers\nsource(output(\n\t\tCustomerID as integer,\n\t\tCustomerName as string,\n\t\tBillToCustomerID as integer,\n\t\tCustomerCategoryID as integer,\n\t\tBuyingGroupID as integer,\n\t\tPrimaryContactPersonID as integer,\n\t\tAlternateContactPersonID as integer,\n\t\tDeliveryMethodID as integer,\n\t\tDeliveryCityID as integer,\n\t\tPostalCityID as integer,\n\t\tCreditLimit as decimal(18,2),\n\t\tAccountOpenedDate as date,\n\t\tStandardDiscountPercentage as decimal(18,3),\n\t\tIsStatementSent as boolean,\n\t\tIsOnCreditHold as boolean,\n\t\tPaymentDays as integer,\n\t\tPhoneNumber as string,\n\t\tFaxNumber as string,\n\t\tDeliveryRun as string,\n\t\tRunPosition as string,\n\t\tWebsiteURL as string,\n\t\tDeliveryAddressLine1 as string,\n\t\tDeliveryAddressLine2 as string,\n\t\tDeliveryPostalCode as string,\n\t\tDeliveryLocation as binary,\n\t\tPostalAddressLine1 as string,\n\t\tPostalAddressLine2 as string,\n\t\tPostalPostalCode as string,\n\t\tLastEditedBy as integer,\n\t\tValidFrom as timestamp,\n\t\tValidTo as timestamp,\n\t\tIsActive as integer,\n\t\tSurrogateKey as integer\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tisolationLevel: 'READ_UNCOMMITTED',\n\tformat: 'table') ~> SalesCustomersTable\nCustomers derive(IsActive = 1) ~> AddingIsActive\nAddingIsActive keyGenerate(output(SurrogateKey as long),\n\tstartAt: 1L) ~> SurrogateKey1\nSalesCustomersTable select(mapColumn(\n\t\tSQL_CustomerID = CustomerID,\n\t\tSQL_CustomerName = CustomerName,\n\t\tSQL_BillToCustomerID = BillToCustomerID,\n\t\tSQL_CustomerCategoryID = CustomerCategoryID,\n\t\tSQL_BuyingGroupID = BuyingGroupID,\n\t\tSQL_PrimaryContactPersonID = PrimaryContactPersonID,\n\t\tSQL_AlternateContactPersonID = AlternateContactPersonID,\n\t\tSQL_DeliveryMethodID = DeliveryMethodID,\n\t\tSQL_DeliveryCityID = DeliveryCityID,\n\t\tSQL_PostalCityID = PostalCityID,\n\t\tSQL_CreditLimit = CreditLimit,\n\t\tSQL_AccountOpenedDate = AccountOpenedDate,\n\t\tSQL_StandardDiscountPercentage = StandardDiscountPercentage,\n\t\tSQL_IsStatementSent = IsStatementSent,\n\t\tSQL_IsOnCreditHold = IsOnCreditHold,\n\t\tSQL_PaymentDays = PaymentDays,\n\t\tSQL_PhoneNumber = PhoneNumber,\n\t\tSQL_FaxNumber = FaxNumber,\n\t\tSQL_DeliveryRun = DeliveryRun,\n\t\tSQL_RunPosition = RunPosition,\n\t\tSQL_WebsiteURL = WebsiteURL,\n\t\tSQL_DeliveryAddressLine1 = DeliveryAddressLine1,\n\t\tSQL_DeliveryAddressLine2 = DeliveryAddressLine2,\n\t\tSQL_DeliveryPostalCode = DeliveryPostalCode,\n\t\tSQL_DeliveryLocation = DeliveryLocation,\n\t\tSQL_PostalAddressLine1 = PostalAddressLine1,\n\t\tSQL_PostalAddressLine2 = PostalAddressLine2,\n\t\tSQL_PostalPostalCode = PostalPostalCode,\n\t\tSQL_LastEditedBy = LastEditedBy,\n\t\tSQL_ValidFrom = ValidFrom,\n\t\tSQL_ValidTo = ValidTo,\n\t\tSQL_IsActive = IsActive,\n\t\tSQL_SurrogateKey = SurrogateKey\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> Select1\nCustomers, Select1 lookup(CustomerID == SQL_CustomerID,\n\tmultiple: true,\n\tbroadcast: 'auto')~> Lookup1\nLookup1 filter(!isNull(SQL_CustomerID)) ~> ExistingRows\nSelect2 derive(SQL_IsActive = 0) ~> DerivedColumn1\nDerivedColumn1 alterRow(updateIf(1==1)) ~> AlterRow1\nExistingRows select(mapColumn(\n\t\tSQL_CustomerID,\n\t\tSQL_CustomerName,\n\t\tSQL_BillToCustomerID,\n\t\tSQL_CustomerCategoryID,\n\t\tSQL_BuyingGroupID,\n\t\tSQL_PrimaryContactPersonID,\n\t\tSQL_AlternateContactPersonID,\n\t\tSQL_DeliveryMethodID,\n\t\tSQL_DeliveryCityID,\n\t\tSQL_PostalCityID,\n\t\tSQL_CreditLimit,\n\t\tSQL_AccountOpenedDate,\n\t\tSQL_StandardDiscountPercentage,\n\t\tSQL_IsStatementSent,\n\t\tSQL_IsOnCreditHold,\n\t\tSQL_PaymentDays,\n\t\tSQL_PhoneNumber,\n\t\tSQL_FaxNumber,\n\t\tSQL_DeliveryRun,\n\t\tSQL_RunPosition,\n\t\tSQL_WebsiteURL,\n\t\tSQL_DeliveryAddressLine1,\n\t\tSQL_DeliveryAddressLine2,\n\t\tSQL_DeliveryPostalCode,\n\t\tSQL_DeliveryLocation,\n\t\tSQL_PostalAddressLine1,\n\t\tSQL_PostalAddressLine2,\n\t\tSQL_PostalPostalCode,\n\t\tSQL_LastEditedBy,\n\t\tSQL_ValidFrom,\n\t\tSQL_ValidTo,\n\t\tSQL_IsActive,\n\t\tSQL_SurrogateKey\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> Select2\nSurrogateKey1 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tinput(\n\t\tCustomerID as integer,\n\t\tCustomerName as string,\n\t\tBillToCustomerID as integer,\n\t\tCustomerCategoryID as integer,\n\t\tBuyingGroupID as integer,\n\t\tPrimaryContactPersonID as integer,\n\t\tAlternateContactPersonID as integer,\n\t\tDeliveryMethodID as integer,\n\t\tDeliveryCityID as integer,\n\t\tPostalCityID as integer,\n\t\tCreditLimit as decimal(18,2),\n\t\tAccountOpenedDate as date,\n\t\tStandardDiscountPercentage as decimal(18,3),\n\t\tIsStatementSent as boolean,\n\t\tIsOnCreditHold as boolean,\n\t\tPaymentDays as integer,\n\t\tPhoneNumber as string,\n\t\tFaxNumber as string,\n\t\tDeliveryRun as string,\n\t\tRunPosition as string,\n\t\tWebsiteURL as string,\n\t\tDeliveryAddressLine1 as string,\n\t\tDeliveryAddressLine2 as string,\n\t\tDeliveryPostalCode as string,\n\t\tDeliveryLocation as binary,\n\t\tPostalAddressLine1 as string,\n\t\tPostalAddressLine2 as string,\n\t\tPostalPostalCode as string,\n\t\tLastEditedBy as integer,\n\t\tValidFrom as timestamp,\n\t\tValidTo as timestamp,\n\t\tIsActive as integer,\n\t\tSurrogateKey as integer\n\t),\n\tdeletable:false,\n\tinsertable:true,\n\tupdateable:false,\n\tupsertable:false,\n\tformat: 'table',\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\tsaveOrder: 2,\n\terrorHandlingOption: 'stopOnFirstError',\n\tmapColumn(\n\t\tCustomerID,\n\t\tCustomerName,\n\t\tBillToCustomerID,\n\t\tCustomerCategoryID,\n\t\tBuyingGroupID,\n\t\tPrimaryContactPersonID,\n\t\tAlternateContactPersonID,\n\t\tDeliveryMethodID,\n\t\tDeliveryCityID,\n\t\tPostalCityID,\n\t\tCreditLimit,\n\t\tAccountOpenedDate,\n\t\tStandardDiscountPercentage,\n\t\tIsStatementSent,\n\t\tIsOnCreditHold,\n\t\tPaymentDays,\n\t\tPhoneNumber,\n\t\tFaxNumber,\n\t\tDeliveryRun,\n\t\tRunPosition,\n\t\tWebsiteURL,\n\t\tDeliveryAddressLine1,\n\t\tDeliveryAddressLine2,\n\t\tDeliveryPostalCode,\n\t\tDeliveryLocation,\n\t\tPostalAddressLine1,\n\t\tPostalAddressLine2,\n\t\tPostalPostalCode,\n\t\tLastEditedBy,\n\t\tValidFrom,\n\t\tValidTo,\n\t\tIsActive,\n\t\tSurrogateKey\n\t)) ~> sink1\nAlterRow1 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tinput(\n\t\tCustomerID as integer,\n\t\tCustomerName as string,\n\t\tBillToCustomerID as integer,\n\t\tCustomerCategoryID as integer,\n\t\tBuyingGroupID as integer,\n\t\tPrimaryContactPersonID as integer,\n\t\tAlternateContactPersonID as integer,\n\t\tDeliveryMethodID as integer,\n\t\tDeliveryCityID as integer,\n\t\tPostalCityID as integer,\n\t\tCreditLimit as decimal(18,2),\n\t\tAccountOpenedDate as date,\n\t\tStandardDiscountPercentage as decimal(18,3),\n\t\tIsStatementSent as boolean,\n\t\tIsOnCreditHold as boolean,\n\t\tPaymentDays as integer,\n\t\tPhoneNumber as string,\n\t\tFaxNumber as string,\n\t\tDeliveryRun as string,\n\t\tRunPosition as string,\n\t\tWebsiteURL as string,\n\t\tDeliveryAddressLine1 as string,\n\t\tDeliveryAddressLine2 as string,\n\t\tDeliveryPostalCode as string,\n\t\tDeliveryLocation as binary,\n\t\tPostalAddressLine1 as string,\n\t\tPostalAddressLine2 as string,\n\t\tPostalPostalCode as string,\n\t\tLastEditedBy as integer,\n\t\tValidFrom as timestamp,\n\t\tValidTo as timestamp,\n\t\tIsActive as integer,\n\t\tSurrogateKey as integer\n\t),\n\tdeletable:false,\n\tinsertable:false,\n\tupdateable:true,\n\tupsertable:false,\n\tkeys:['SurrogateKey'],\n\tformat: 'table',\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\tsaveOrder: 1,\n\terrorHandlingOption: 'stopOnFirstError',\n\tmapColumn(\n\t\tCustomerID = SQL_CustomerID,\n\t\tCustomerName = SQL_CustomerName,\n\t\tBillToCustomerID = SQL_BillToCustomerID,\n\t\tCustomerCategoryID = SQL_CustomerCategoryID,\n\t\tBuyingGroupID = SQL_BuyingGroupID,\n\t\tPrimaryContactPersonID = SQL_PrimaryContactPersonID,\n\t\tAlternateContactPersonID = SQL_AlternateContactPersonID,\n\t\tDeliveryMethodID = SQL_DeliveryMethodID,\n\t\tDeliveryCityID = SQL_DeliveryCityID,\n\t\tPostalCityID = SQL_PostalCityID,\n\t\tCreditLimit = SQL_CreditLimit,\n\t\tAccountOpenedDate = SQL_AccountOpenedDate,\n\t\tStandardDiscountPercentage = SQL_StandardDiscountPercentage,\n\t\tIsStatementSent = SQL_IsStatementSent,\n\t\tIsOnCreditHold = SQL_IsOnCreditHold,\n\t\tPaymentDays = SQL_PaymentDays,\n\t\tPhoneNumber = SQL_PhoneNumber,\n\t\tFaxNumber = SQL_FaxNumber,\n\t\tDeliveryRun = SQL_DeliveryRun,\n\t\tRunPosition = SQL_RunPosition,\n\t\tWebsiteURL = SQL_WebsiteURL,\n\t\tDeliveryAddressLine1 = SQL_DeliveryAddressLine1,\n\t\tDeliveryAddressLine2 = SQL_DeliveryAddressLine2,\n\t\tDeliveryPostalCode = SQL_DeliveryPostalCode,\n\t\tDeliveryLocation = SQL_DeliveryLocation,\n\t\tPostalAddressLine1 = SQL_PostalAddressLine1,\n\t\tPostalAddressLine2 = SQL_PostalAddressLine2,\n\t\tPostalPostalCode = SQL_PostalPostalCode,\n\t\tLastEditedBy = SQL_LastEditedBy,\n\t\tValidFrom = SQL_ValidFrom,\n\t\tValidTo = SQL_ValidTo,\n\t\tIsActive = SQL_IsActive,\n\t\tSurrogateKey = SQL_SurrogateKey\n\t)) ~> sink2"
		}
	}
}